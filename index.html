<!DOCTYPE html>
<html>
    <head>
        <title> Parakh-Login </title>
        <meta id="meta" name="google-signin-client_id" content="">
        <link rel="icon" id="favicon" type="image/jpg" href="" />
        
        <link href="css/login.css" rel="stylesheet" type="text/css"/>
        <link href="css/custom.css" rel="stylesheet" type="text/css"/>
        <link href="css/common.css" rel="stylesheet" type="text/css"/>
        <style>

        </style>
        <script>

            function signinOnclick() {
                var auth2;
                gapi.load('auth2', function () {
                    /**
                     * Retrieve the singleton for the GoogleAuth library and set up the
                     * client.
                     */

                    gapi.auth2.getAuthInstance({
                        client_id: clientId
                    }).attachClickHandler('my-signin2', {}, onSuccess, onFailure);
                    function onSuccess(user) {
                        //console.log(user.getBasicProfile());
                        var email = user.getBasicProfile().U3;
                        var pic = user.getBasicProfile().Paa;
                        var name = user.getBasicProfile().ig;
                        setCookie("email",email,1);
                        setCookie("name",name,1);
                        // setCookie("picture",pic,1);                    
                        $.ajax({
                            headers: {secret: secret},
                            type: 'POST',
                            url: imageCacheUrl,
                            data: {img : user.getBasicProfile().Paa.replace("s96-c/",""),timestamp : Math.floor(Date.now()),'email':email},
                            success: function(result){
                                data = jQuery.parseJSON(result);
                                setCookie("picture",data.data,1);
                                window.location = window.location.href + "dashboard.html";
                            }
                        });
                        
                        // setTimeout(function () {
                        //     window.location = window.location.href + "dashboard.html";
                        // }, 500);

                    }
                    ;
                    /**
                     * Handle sign-in failures.
                     */
                    var onFailure = function (error) {
                        console.log(error);
                    };

                });
                /**
                 * Handle successful sign-ins.
                 */

            }

            function login()
            {
                var email = $('#email').val();
                if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email))  
                {  
                    $.ajax({
                        headers: {secret: secret},
                        type: 'GET',
                        url: getUserByEmail+email,
                        data: {},
                        success: function(result){
                            data = jQuery.parseJSON(result);
                            setCookie("email",data.data.google_email,1);
                            setCookie("name",data.data.google_name,1);
                            setCookie("picture",data.data.google_picture_link,1);
                            window.location = window.location.href + "dashboard.html";
                        }
                    }); 
                }else
                {
                    alert('Please enter correct email');
                }
            }

            function callBackFunction() {
                renderButton();
                signinOnclick();

            }
            function renderButton() {
                gapi.signin2.render('my-signin2', {
                    'scope': 'profile email',
                    'width': 340,
                    'height': 60,
                    'longtitle': true,
                    'theme': 'dark'
                });
            }
            function setCookie(cname, cvalue, exdays) {
                var d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                var expires = "expires=" + d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            }
            function getCookie(cname) {
                var name = cname + "=";
                var ca = document.cookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') {
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) == 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            }
        </script>
        
        <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js'></script>
        <script>
            //Add images
            console.log(getCookie('image') == "");
            var images = ['images/parakh.jpg', 'images/parakh2.jpg'];
            
            var thisImage = images[Math.floor(Math.random() * images.length)];
            //setting the path
            $(document).ready(function () {
                $("#login-background").css("background", "url('" + thisImage + "') no-repeat fixed center top / cover");
            });
        </script>

    </head>
    <body id="login-background">
        <div class="login-btn">
        <input type="text" name="email" value='' class="" id="email">
        <button onclick="login()">Submit</button>
        <img class="login-btn hide" src="images/sign-in-with-google.png" id="my-signin2"/>
        </div>
        <div  class="login-logo">
            <img src="images/login-logo.png"/>
        </div>
        <script src="js/libs/customLib/mainPageJs.js" type="text/javascript"></script>
        <script src="https://apis.google.com/js/platform.js?onload=callBackFunction" async defer></script>
    </body>
</html>